# Provison z/OSMF template in CP&M and perform instance actions

This collection provides a module `workflow` as well as a role [complete_workflow](../roles/complete_workflow/README.md) to work with z/OS workflows based on z/OSMF workflow RESTful services. The module will communicate with z/OSMF workflow RESTful services to manipulate workflow based on different parameters it receives.

CP&M currently providing 2 roles:

- [Provision](../roles/complete_cpm_provision): Allow user provision instance base CP&M published template by calling it's RESTful services.

- [Action](../roles/complete_cpm_action): Allow user perform instance action.

**NOTE**:

- `delegate_to` - The “delegate_to: localhost” statement is required when using the module in your playbook's task, which makes the module run locally (in control node), so that it does not need to set up SSH connection and install Python on all of the target z/OS systems. Instead, the module will set up HTTPS connections with z/OSMF server. The “delegate_to: localhost” statement is hard-coded inside the role.

- `Check Mode` - The module does not support check mode. (dry run or test run)

## Roles Specification

- [complete_cpm_provision](../roles/complete_cpm_provision):
Variables:
  - instance_record_dir: Path of the directory that provision role will write instance information in json to
  - zmf_username: z/OSMF username for provision request
  - zmf_password: z/OSMF password
  - instance_info_json_path: Path to the file that holds provisioned instance information, `complete_cpm_provison` role will automatically generate this variable in the foramt of `<instance_record_dir>/<template_name>-<instance external_name>.json`
  - zmf_host: z/OSMF host uri, excluding https, including port
  - cpm_template_name: Template name for provision
  - domain_name: Domain name contains the template
  - tenant_name: Tenant name that associate with the template
  - systems_nicknames: System nick name, no multi-sysplex support at current stage
  - api_polling_retry_count: Total retries number before role exit with failure waiting on provision complete
  - api_polling_interval_seconds: Interval for eacho provision status polling in seconds.

- [complete_cpm_action](../roles/complete_cpm_action):
  - zmf_host: z/OSMF host uri, excluding https, including port
  - zmf_username: z/OSMF username for provision request
  - zmf_password: z/OSMF password
  - instance_action_name: Deprovision action name
  - instance_info_json_path: Path to the json file that holds provisioned instance information, file should be generated by the provision role.
  - api_polling_retry_count: Total retries number before role exit with failure waiting on provision complete
  - api_polling_interval_seconds: Interval for eacho provision status polling in seconds.

## Requirements

### Control Node

- [Ansible](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html) - 2.9 or later.
- [Python](https://www.python.org/downloads/release/latest) -  3.7 or later.
- [Requests library for Python](https://requests.readthedocs.io/en/latest/) - 2.23 or later.

### complete_cpm_provision

Addtional required Python library listed [here](../roles/complete_cpm_provision/requirement.txt)

### Managed Node

- [z/OS](https://www.ibm.com/support/knowledgecenter/SSLTBW_2.3.0/com.ibm.zos.v2r3/en/homepage.html) - 2.3 or later.

## Usage

Please refer to directory [examples](../examples/README.md) for various example playbooks.

## Test

Please refer to directory [tests/cpm](../tests/cpm/README.md).

## Copyright

© Copyright IBM Corporation 2020
